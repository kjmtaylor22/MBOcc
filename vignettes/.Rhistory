geom_point(aes(x=Age, y=pc1_scale, color=L1,
shape=pref, fill=pref), size=1.5, show.legend = c("color"=F)) +
scale_shape_manual(values=c(22,21,24)) +
scale_fill_manual(values=c("black","grey","white")) +
theme_bw() + theme(strip.background.y=element_blank(), strip.clip = "off",
strip.text.y = element_blank(),
plot.margin = unit(c(2,2,0,2),"mm"), panel.spacing.y = unit(0,"mm"),
panel.spacing.x = unit(1,"mm"), #axis.ticks.x = element_blank(),
#axis.text.x=element_blank(), axis.title.x=element_blank(),
legend.title = element_text(hjust=0.5), legend.key.height=unit(2,"mm"),
legend.justification = "right", legend.spacing.y = unit(1, "mm")) +
scale_color_manual(values=pa_summary$col) +
scale_x_continuous(breaks=c(1,16,36)) + ylim(0,1) +
guides(shape=guide_legend(order=1, position="bottom", direction="vertical"),
fill=guide_legend(order=1, position="bottom", direction="vertical"),
color=guide_legend(order=2,position="right", direction="vertical", ncol=1)) +
labs(title="Site-specific occupancy and abundance mantenance in the flock metacommunity",
x="Age (weeks)", y="Occupancy",
color=NULL, shape="Site preference (Relative)", fill="Site preference (Relative)")
p_ar2 <- ggplot(ar_summary) + facet_grid(g~Flock, scales="free") +
geom_hline(yintercept=0.5, color="grey60", linetype="12") +
geom_path(aes(x=Age, y=pc1_scale, color=L1), linewidth=1) +
geom_point(aes(x=Age, y=pc1_scale, color=L1,
shape=pref, fill=pref), size=1.5, show.legend = c("shape"=F,"fill"=F)) +
scale_shape_manual(values=c(22,21,24)) +
scale_fill_manual(values=c("black","grey","white")) +
theme_bw() + theme(strip.background.y=element_blank(), strip.clip = "off",
#strip.text.x=element_blank(),
plot.margin = unit(c(2,2,2,2),"mm"), panel.spacing.y = unit(0,"mm"),
panel.spacing.x = unit(1,"mm"), axis.text.x=element_text(size=9),
legend.key.height=unit(2,"mm"), legend.title.position = "top",
legend.justification = "left",
legend.title = element_text(hjust=0.5), legend.box = "horizontal") +
scale_color_manual(values=ar_summary$col) +
scale_x_continuous(breaks=c(1,16,36)) + ylim(0,1) +
guides(shape=guide_legend(order=1, position="right", direction="vertical"),
fill=guide_legend(order=1, position="right", direction="vertical"),
color=guide_legend(order=2,position="bottom", direction="vertical", ncol=2)) +
labs(x="Age (weeks)", y="Abundance maintenance",
color=NULL, shape="Site preference (Relative)", fill="Site preference (Relative)")
egg::ggarrange(p_pa1,p_ar2,nrow=1)
egg::ggarrange(pa12, ar12, nrow=1)
help(annotate)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, fill="mediumblue", alpha=0.08) +
annotate(geom="text", x=Inf, y=Inf, label="resp-preferred", vjust=1.1, hjust=1.1, color="skyblue4") +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, fill="magenta", alpha=0.08) +
annotate(geom="text", x=Inf, y=-Inf, label="gut-preferred", vjust=-0.1, hjust=1.1, color="maroon4") +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -3.3, -0.7, 0.9, 2.3)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
ar_scree <- data.frame(pc=names(ar$sdev), var=t(ar$sdev^2/sum(ar$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
ar12 <- pcplot(ar, "PC1","PC2",F,F) + labs(title="Abundance-Rarity") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44"))  +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, fill="mediumblue", alpha=0.08) +
annotate(geom="text", x=Inf, y=Inf, label="resp-preferred", vjust=1.1, hjust=1.1, color="skyblue4") +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, fill="magenta", alpha=0.08) +
annotate(geom="text", x=Inf, y=-Inf, label="gut-preferred", vjust=-0.2, hjust=1.1, color="maroon4") +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(ar_scree), -4, -0.8, 1.3, 3.5)
ar12_labs <- rbind(subset(ar12$data, subset=model=="intercept-only"),
subset(ar12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
arR12_lines <- subset(ar12$data, subset=model=="regression")
ar12 <- ar12 + geom_point(data=ar12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=ar12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=arR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa$loadings
blocks <- data.frame(label=c("resp-preferred","gut-preferred"),
fill=c("mediumblue","magenta"),
color=c("skyblue4","maroon4"))
blocks
pref_pa <- data.frame(PC2=pa$loadings$PC2,pref=rep(c("gut-preferred","resp-preferred"),each=2)
pref_pa <- data.frame(PC2=pa$loadings$PC2,pref=rep(c("gut-preferred","resp-preferred"),each=2))
pref_pa <- data.frame(PC2=pa$loadings$PC2[-5],pref=rep(c("gut-preferred","resp-preferred"),each=2))
pref_pa
pref_ar <- data.frame(PC2=ar$loadings$PC2[-5],pref=rep(c("gut-preferred","resp-preferred"),each=2))
pref_ar
blocks <- data.frame(label=c("resp-preferred","gut-preferred"),
fill=c("mediumblue","magenta"),
color=c("skyblue4","maroon4"))
pref_pa <- data.frame(PC2=pa$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks)
pref_ar <- data.frame(PC2=ar$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks)
pref_pa
pref_pa <- data.frame(PC2=pa$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks) %>% group_by(label, fill, color) %>% summarize_at(vars(PC2),mean)
pref_ar <- data.frame(PC2=ar$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks) %>% group_by(label, fill, color) %>% summarize_at(vars(PC2),mean)
pref_pa
pref_ar
pref_pa <- data.frame(PC2=pa$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks) %>% group_by(label, fill, color) %>% summarize_at(vars(PC2),mean) %>%
mutate(positive=PC2>0)
pref_ar <- data.frame(PC2=ar$loadings$PC2[-5],label=rep(c("gut-preferred","resp-preferred"),each=2)) %>%
left_join(blocks) %>% group_by(label, fill, color) %>% summarize_at(vars(PC2),mean) %>%
mutate(positive=PC2>0)
pref_pa
selpa <- expression(which(pref_pa$positive))
selar <- expression(which(pref_ar$positive))
selpa
eval(selpa)
selpaT <- expression(which(pref_pa$positive))
selarT <- expression(which(pref_ar$positive))
selpaF <- expression(which(!pref_pa$positive))
selarF <- expression(which(!pref_ar$positive))
eval(selpaF)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -3.3, -0.7, 0.9, 2.3)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
ar_scree <- data.frame(pc=names(ar$sdev), var=t(ar$sdev^2/sum(ar$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
ar12 <- pcplot(ar, "PC1","PC2",F,F) + labs(title="Abundance-Rarity") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44"))  +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_ar[eval(selarT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_ar[eval(selarT),"label"], color=pref_ar[eval(selarT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_ar[eval(selarF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_ar[eval(selarF),"label"], color=pref_ar[eval(selarF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(ar_scree), -4, -0.8, 1.3, 3.5)
ar12_labs <- rbind(subset(ar12$data, subset=model=="intercept-only"),
subset(ar12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
arR12_lines <- subset(ar12$data, subset=model=="regression")
ar12 <- ar12 + geom_point(data=ar12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=ar12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=arR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -3, -0.5, 0.9, 2.5)
pa12
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -3, -0.5, 0.9, 2.5)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
ar_scree <- data.frame(pc=names(ar$sdev), var=t(ar$sdev^2/sum(ar$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
ar12 <- pcplot(ar, "PC1","PC2",F,F) + labs(title="Abundance-Rarity") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44"))  +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_ar[eval(selarT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_ar[eval(selarT),"label"], color=pref_ar[eval(selarT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_ar[eval(selarF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_ar[eval(selarF),"label"], color=pref_ar[eval(selarF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(ar_scree), -2.5, 1, 2, 4)
ar12_labs <- rbind(subset(ar12$data, subset=model=="intercept-only"),
subset(ar12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
arR12_lines <- subset(ar12$data, subset=model=="regression")
ar12 <- ar12 + geom_point(data=ar12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=ar12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=arR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -2.5, -0.5, 1.2, 2.5)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
ar_scree <- data.frame(pc=names(ar$sdev), var=t(ar$sdev^2/sum(ar$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
ar12 <- pcplot(ar, "PC1","PC2",F,F) + labs(title="Abundance-Rarity") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44"))  +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_ar[eval(selarT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_ar[eval(selarT),"label"], color=pref_ar[eval(selarT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_ar[eval(selarF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_ar[eval(selarF),"label"], color=pref_ar[eval(selarF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(ar_scree), -2.5, 0.5, 2, 4.2)
ar12_labs <- rbind(subset(ar12$data, subset=model=="intercept-only"),
subset(ar12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
arR12_lines <- subset(ar12$data, subset=model=="regression")
ar12 <- ar12 + geom_point(data=ar12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=ar12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=arR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -2.7, -0.5, 1, 2.7)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
ar_scree <- data.frame(pc=names(ar$sdev), var=t(ar$sdev^2/sum(ar$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
ar12 <- pcplot(ar, "PC1","PC2",F,F) + labs(title="Abundance-Rarity") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44"))  +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_ar[eval(selarT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_ar[eval(selarT),"label"], color=pref_ar[eval(selarT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_ar[eval(selarF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_ar[eval(selarF),"label"], color=pref_ar[eval(selarF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(ar_scree), -2.5, 0.5, 2.3, 4.5)
ar12_labs <- rbind(subset(ar12$data, subset=model=="intercept-only"),
subset(ar12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
arR12_lines <- subset(ar12$data, subset=model=="regression")
ar12 <- ar12 + geom_point(data=ar12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=ar12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=arR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -2.8, -0.3, 1, 2.6)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
pa_scree <- data.frame(pc=names(pa$sdev), var=t(pa$sdev^2/sum(pa$sdev^2))) %>%
ggplot() + theme_bw() + geom_col(aes(pc, var), fill="grey40") +
coord_flip() + scale_y_continuous(breaks=c(0, 0.5)) +
theme(plot.background = element_blank(), text=element_text(size=9)) +
labs(x=NULL, y=NULL)
## PC1 and PC2
pa12 <- pcplot(pa, "PC1","PC2",F,F) + labs(title="Presence-Absence") +
theme(plot.title = element_text(size=9, face="bold")) +
scale_linetype_manual(values=c("solid","dashed","twodash","22","81","44")) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymin=0.5, ymax=Inf, alpha=0.08,
fill=pref_pa[eval(selpaT),"fill"]) +
annotate(geom="text", x=Inf, y=Inf, vjust=1.1, hjust=1.1,
label=pref_pa[eval(selpaT),"label"], color=pref_pa[eval(selpaT),"color"]) +
annotate(geom="rect", xmin=-Inf, xmax=Inf, ymax=-0.5, ymin=-Inf, alpha=0.08,
fill=pref_pa[eval(selpaF),"fill"]) +
annotate(geom="text", x=Inf, y=-Inf, vjust=-0.1, hjust=1.1,
label=pref_pa[eval(selpaF),"label"], color=pref_pa[eval(selpaF),"color"]) +
annotate(geom="text", x=0, y=0, label="- \u2190 no preference \u2192 +", vjust=0.5, hjust=0.5, color="black") +
annotation_custom(grob=ggplotGrob(pa_scree), -2.8, -0.3, 1.1, 2.6)
pa12_labs <- rbind(subset(pa12$data, subset=model=="intercept-only"),
subset(pa12$data, subset=model=="regression") %>%
group_by(name, factor) %>%
mutate(max=max(as.numeric(label))) %>%
.[which(as.numeric(.$label)==.$max),] %>% .[,-ncol(.)])
paR12_lines <- subset(pa12$data, subset=model=="regression")
pa12 <- pa12 + geom_point(data=pa12_labs, aes(PC1,PC2,color=L1,fill=L1,shape=name),
size=2, show.legend = F) +
ggrepel::geom_text_repel(data=pa12_labs, aes(PC1,PC2,color=L1,label=label),
size=3, show.legend = F, min.segment.length=0.1, max.overlaps=5,
seed=6588, force_pull=1, force=10, direction="both") +
geom_path(data=paR12_lines,aes(PC1,PC2, color=L1, linetype=factor),
linewidth=0.5, show.legend = F)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
egg::ggarrange(pa12, ar12+theme(plot.margin=margin(2,2,2,2,"mm")), nrow=1)
## Grab the list of the best models for each taxon
tab0 <- mb0$best
## Split formulae into just the first (since they're all the same here)
tab0$formulae <- sapply(tab0$formulae,
function(x){
return(strsplit(x,", ")[[1]][[1]])})
## Output table using kableExtra
tab0 %>%
.[order(.$formulae, .$psi, .$taxon, decreasing = c(T,F,F), method = "radix"),c(1,2,4,3,5)] %>%
`colnames<-`(c("Taxon","Model","\u03a8CINT","BIC", "\u0394BIC")) %>%
kbl(caption = "The best model for each species (presence-absence)") %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
## Grab the list of the best models for each taxon
tabM <- mbM$best
## Split formulae into just the first (since they're all the same here)
tabM$formulae <- sapply(tabM$formulae,
function(x){
return(strsplit(x,", ")[[1]][[1]])})
## Output table using kableExtra
tabM %>%
.[order(.$formulae, .$psi, .$taxon, decreasing = c(T,F,F), method = "radix"),c(1,2,4,3,5)] %>%
`colnames<-`(c("Taxon","Model","\u03a8CINT","BIC", "\u0394BIC")) %>%
kbl(caption = "The best model for each species (abundance-rarity)") %>%
kable_classic(full_width = T, html_font = "Cambria") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
