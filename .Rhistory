geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=3, limits=c(-1,1),
labels=c(expression(p[below]),"mean",expression(p[above]))) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=3, limits=c(-1,1),
labels=c(expression(p[below(0)]),"mean",expression(p[above(1)]))) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=3, limits=c(-1,1),
labels=c(expression(p[below (0)]),"mean",expression(p[above (1)]))) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[below (0)]),"mean",
expression(p[above (1)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c("-1",expression(p[below (0)]),"mean",
expression(p[above (1)]), "1")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[below (0)]),"mean",
expression(p[above (1)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(-1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[below (0)]),"mean",
expression(p[above (1)]), " ")) +
xlim(-1,NA) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[below (0)]),"mean",
expression(p[above (1)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 below]),"mean",
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 "below"]),"mean",
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0[(below)]]),"mean",
expression(p[1[(above)]]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Escherichia Shigella")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus vaginalis")) +
facet_grid(X2~X1+Species+Rearing, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus vaginalis")) +
facet_grid(X2~Species+Rearing+X1, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
means <- reshape2::melt(commsetMeans) %>%
#tidyr::separate(col = "variable", into = c("ASV","param"), sep = "_") %>%
subset(., subset=variable%in%names(formatM)) %>%
mutate(base10mean=10^value) %>% #, base10var=10^(2*mean+var)*(10^var-1))  %>%
#reshape2::dcast(X1 + X2 ~ variable, value.var="base10mean") %>%
left_join(unique(meta[,c(2,10,19)]), by=c("X1"="Experiment")) %>%
left_join(unique(bagM$P.site[,c(1,3,4,5,6,7,9)]),
by=c("X1"="Experiment",
"X2"="variable",
"variable"="L1",
"Species"="Species",
"Rearing"="Rearing")) %>%
mutate(above=exp(value.y)/(1+exp(value.y))) %>%
mutate(below=above-1) %>% .[,-c(4,10)]
means <- reshape2::melt(commsetMeans) %>%
#tidyr::separate(col = "variable", into = c("ASV","param"), sep = "_") %>%
subset(., subset=variable%in%names(formatM)) %>%
mutate(base10mean=10^value) %>% #, base10var=10^(2*mean+var)*(10^var-1))  %>%
#reshape2::dcast(X1 + X2 ~ variable, value.var="base10mean") %>%
left_join(unique(meta[,c(2,10,19)]), by=c("X1"="Experiment")) %>%
left_join(unique(bagM$P.site[,c(1,3,4,5,6,7,9)]),
by=c("X1"="Experiment",
"X2"="variable",
"variable"="L1",
"Species"="Species",
"Rearing"="Rearing")) %>%
mutate(category=value.y>0, above=exp(value.y)/(1+exp(value.y))) %>%
mutate(below=above-1) %>% .[,-c(4,10)] %>%
reshape2::melt(id.vars=c(1:9), variable.name="abundance", value.name="p") %>%
subset(subset=!is.nan(base10mean)&!is.na(p))
means$category <- factor(means$category, labels=c("R","A"))
means$category[-0.5<means$p<0.5] <- NA
means$category[which(-0.5<means$p<0.5)] <- NA
means$category[which(-0.5<means$p&means$p<0.5)] <- NA
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~Species+Rearing+X1, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
geom_text(aes(as.factor(Age_weeks), y=p, label=category), size=2, color="black") +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~Species+Rearing+X1, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
geom_text(aes(as.factor(Age_weeks), y=p, label=category), size=2, color="black") +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability", title="Lactobacillus salivarius")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~Species+Rearing+X1, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
geom_text(aes(as.factor(Age_weeks), y=p, label=category), size=2, color="black") +
theme_minimal() + scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability", caption="Lactobacillus salivarius")
ggplot(subset(means, subset=variable=="Lactobacillus salivarius")) +
facet_grid(X2~Species+Rearing+X1, scales="free_x", space = "free_x") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=0, ymax=1), fill="tomato") +
geom_rect(aes(xmin=0, xmax=Inf, ymin=-1, ymax=0), fill="turquoise3") +
geom_col(aes(as.factor(Age_weeks), p, fill=abundance), position="stack") +
geom_hline(yintercept=0, color="black", linewidth=1) +
geom_label(aes(1,0,label=round(base10mean)), color="black", family="bold", size=2.5) +
geom_text(aes(as.factor(Age_weeks), y=p, label=category), size=2, color="black") +
theme_minimal() + theme(plot.caption = element_text(face = "italic")) +
scale_y_continuous(n.breaks=5, limits=c(-1,1),
labels=c(" ",expression(p[0 (below)]),"mean",
expression(p[1 (above)]), " ")) +
scale_fill_manual(values=c("lightsalmon","powderblue")) +
labs(x="Age (weeks)", y="Abundance change\nprobability", caption="Lactobacillus salivarius")
commsetHist2 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, logcommset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)], na.rm=T)==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist2
View(commsetHist2)
commsetHist2
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
commsetHist1
View(commsetHist1$data)
subset(commsetHist1$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=base10mean), color="black", linewidth=2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
??midpoint
??mid
range(means$base10mean)
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=2) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=mean(range(base10mean))),
label=base10mean), color="black", linewidth=2) +
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=2) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=mean(range(base10mean)),
label=base10mean), color="black", linewidth=2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=2) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=round(mean(range(base10mean))),
label=base10mean), color="black", linewidth=2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=2) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=60,
label=base10mean), color="black", linewidth=2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=2)
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1.5)
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=base10mean, y=5, label=base10mean), color="black") +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1.5) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=base10mean, y=5, label=base10mean), color="black") +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1.5) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=5, label=round(base10mean)), color="black", fill="white", size=3) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1.5) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=-2, label=round(base10mean)), color="black", fill="white", size=3) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist1$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1.5) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=-2, label=round(base10mean)), color="black", fill="white", size=3) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
subset(commsetHist2$data, subset=variable=="Lactobacillus.salivarius") %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
geom_vline(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(xintercept=log10(base10mean)), color="black", linewidth=1) +
geom_label(data=subset(means, subset=variable=="Lactobacillus salivarius"),
aes(x=log10(base10mean), y=-2, label=round(base10mean)), color="black", fill="white", size=3) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2))
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific())
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific()) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific(), n.breaks=4) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific(), n.breaks=2) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific(), n.breaks=3) +
theme(axis.text.x=element_text(angle=30, hjust=1, vjust=0.5, size=8)) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(labels = scales::label_scientific(), n.breaks=3) +
theme(axis.text.x=element_text(angle=30, hjust=1, vjust=1, size=8)) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
## Create new binary matrix from count matrix
commsetHist1 <- data.frame(X1=meta$Experiment, X2=meta$BodySite, commset,
row.names=row.names(commset)) %>% #combine count data with random effect (grouping) vectors
split(., .$X1, drop=T) %>% #split by by Experiment
lapply(., function(x){ #apply to each data frame in the new list
y <- x[,-(which(colSums(x[,-c(1:2)])==0)+2)] %>%
reshape2::melt()
return(y)}) %>%
reshape2::melt(.) %>%
ggplot(., aes(value, fill=variable, color=variable)) +
facet_grid(X1 ~ X2, scales="free") +
geom_histogram(position="identity", alpha=0.2) +
scale_x_continuous(n.breaks=3) +
theme(axis.text.x=element_text(angle=30, hjust=1, vjust=1, size=8)) +
guides(fill=guide_legend(ncol=2), color=guide_legend(ncol=2)); commsetHist1
load("output/poultry_metaanalysis_vignette1.RD")
View(formatM)
remove.packages("MBOcc")
